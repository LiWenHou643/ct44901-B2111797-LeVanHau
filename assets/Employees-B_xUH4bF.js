import{e as k}from"./employee.service-fjTtcrJQ.js";import{c as b,a as f}from"./index.esm-BQ_k1baG.js";import{_ as v,o as n,c as o,a,b as p,d as h,F as w,r as C,t as u,w as m,v as y,e as _,f as V,g as E}from"./index-HVgC_N1k.js";const x={name:"EmployeeTable",props:{employees:Array},data(){return{sortBy:"",sortOrder:"asc"}},computed:{sortedEmployees(){return this.employees.slice().sort((s,t)=>{const i=this.getNestedValue(s,this.sortBy),c=this.getNestedValue(t,this.sortBy);return i===c?0:this.sortOrder==="asc"?i<c?-1:1:i<c?1:-1})}},methods:{sortTable(s){this.sortBy===s?this.sortOrder=this.sortOrder==="asc"?"desc":"asc":(this.sortBy=s,this.sortOrder="asc")},getNestedValue(s,t){return t.split(".").reduce((i,c)=>i&&i[c],s)},async toggleEdit(s){if(s.isEditing)try{await this.saveEmployee(s)}catch(t){console.error("Error saving employee",t),alert("Có lỗi khi thêm mới.")}else s.originalData={...s};s.isEditing=!s.isEditing},getValidationSchema(){return b({hotennv:f().required("Họ tên không được để trống"),chucvu:f().required("Chức vụ không được để trống"),diachi:f().required("Địa chỉ không được để trống"),dienthoai:f().matches(/^\d{10}$/,"Số điện thoại phải có 10 chữ số").required("Số điện thoại không được để trống")})},async saveEmployee(s){try{await this.getValidationSchema().validate(s,{abortEarly:!1});const t=await k.update(s.msnv,s);alert(`Cập nhật thông tin thành công cho: ${t.employee.hotennv}`)}catch(t){if(t.name==="ValidationError"){const i=t.errors.join(`
`);alert(`Có lỗi xảy ra trong dữ liệu:
${i}`)}else this.$emit("reload-employees"),t.response&&t.response.data&&t.response.data.message?alert(t.response.data.message):alert("Có lỗi xảy ra. Vui lòng thử lại.");this.$emit("reload-employees")}},cancelEdit(s){Object.assign(s,s.originalData),s.isEditing=!1},deleteEmployee(s){confirm(`Xác nhận muốn xóa ${s.hotennv}?`)&&k.delete(s.msnv).then(()=>{alert(`Nhân viên ${s.hotennv} được xóa thành công!`),this.$emit("reload-employees")}).catch(t=>{console.error("Có lỗi khi xóa nhân viên:",t)})}}},B={class:"table"},T={key:0},O={key:0,class:"fa fa-arrow-up"},U={key:1,class:"fa fa-arrow-down"},N={key:0},$={key:0,class:"fa fa-arrow-up"},A={key:1,class:"fa fa-arrow-down"},S={key:0},D={key:0,class:"fa fa-arrow-up"},q={key:1,class:"fa fa-arrow-down"},H={key:0},M={key:0,class:"fa fa-arrow-up"},X={key:1,class:"fa fa-arrow-down"},F={key:0},I={key:0},L=["onUpdate:modelValue"],R={key:0},j=["onUpdate:modelValue"],K={key:0},Q=["onUpdate:modelValue"],z={key:0},G=["onUpdate:modelValue"],J={key:0},P=["onUpdate:modelValue"],W=["onClick"],Y=["onClick"],Z=["onClick"];function tt(s,t,i,c,d,r){return n(),o("table",B,[a("thead",null,[a("tr",null,[a("th",{onClick:t[0]||(t[0]=e=>r.sortTable("hotennv"))},[t[4]||(t[4]=p(" Họ tên ")),d.sortBy==="hotennv"?(n(),o("span",T,[d.sortOrder==="asc"?(n(),o("i",O)):(n(),o("i",U))])):h("",!0)]),a("th",{onClick:t[1]||(t[1]=e=>r.sortTable("chucvu"))},[t[5]||(t[5]=p(" Chức vụ ")),d.sortBy==="chucvu"?(n(),o("span",N,[d.sortOrder==="asc"?(n(),o("i",$)):(n(),o("i",A))])):h("",!0)]),a("th",{onClick:t[2]||(t[2]=e=>r.sortTable("diachi"))},[t[6]||(t[6]=p(" Địa chỉ ")),d.sortBy==="diachi"?(n(),o("span",S,[d.sortOrder==="asc"?(n(),o("i",D)):(n(),o("i",q))])):h("",!0)]),a("th",{onClick:t[3]||(t[3]=e=>r.sortTable("dienthoai"))},[t[7]||(t[7]=p(" Điện thoại ")),d.sortBy==="dienthoai"?(n(),o("span",H,[d.sortOrder==="asc"?(n(),o("i",M)):(n(),o("i",X))])):h("",!0)]),t[8]||(t[8]=a("th",null,"Mật khẩu",-1)),t[9]||(t[9]=a("th",null,null,-1))])]),a("tbody",null,[r.sortedEmployees.length===0?(n(),o("tr",F,t[10]||(t[10]=[a("td",{colspan:"5",class:"text-center"}," Không có dữ liệu nhân viên nào! ",-1)]))):h("",!0),(n(!0),o(w,null,C(r.sortedEmployees,e=>(n(),o("tr",{key:e.msnv},[a("td",null,[e.isEditing?m((n(),o("input",{key:1,"onUpdate:modelValue":l=>e.hotennv=l,class:"editable"},null,8,L)),[[y,e.hotennv]]):(n(),o("span",I,u(e.hotennv),1))]),a("td",null,[e.isEditing?m((n(),o("input",{key:1,"onUpdate:modelValue":l=>e.chucvu=l,class:"editable",readonly:""},null,8,j)),[[y,e.chucvu]]):(n(),o("span",R,u(e.chucvu),1))]),a("td",null,[e.isEditing?m((n(),o("input",{key:1,"onUpdate:modelValue":l=>e.diachi=l,class:"editable"},null,8,Q)),[[y,e.diachi]]):(n(),o("span",K,u(e.diachi),1))]),a("td",null,[e.isEditing?m((n(),o("input",{key:1,"onUpdate:modelValue":l=>e.dienthoai=l,class:"editable"},null,8,G)),[[y,e.dienthoai]]):(n(),o("span",z,u(e.dienthoai),1))]),a("td",null,[e.isEditing?m((n(),o("input",{key:1,"onUpdate:modelValue":l=>e.matkhau=l,class:"editable"},null,8,P)),[[y,e.matkhau]]):(n(),o("span",J,u(e.matkhau),1))]),a("td",null,[a("button",{class:"btn btn-success",onClick:l=>r.toggleEdit(e)},u(e.isEditing?"Lưu":"Sửa"),9,W),e.isEditing?(n(),o("button",{key:0,class:"btn btn-secondary",onClick:l=>r.cancelEdit(e)}," Hủy ",8,Y)):h("",!0),e.isEditing?h("",!0):(n(),o("button",{key:1,class:"btn btn-danger",onClick:l=>r.deleteEmployee(e)}," Xóa ",8,Z))])]))),128))])])}const et=v(x,[["render",tt],["__scopeId","data-v-285ca318"]]),st={name:"Employees",components:{EmployeeTable:et},data(){return{employees:[]}},created(){this.fetchEmployees()},methods:{async fetchEmployees(){try{const s=await k.getAll();this.employees=s}catch(s){console.error("Error fetching employees:",s)}},reloadEmployees(){this.fetchEmployees()},async deleteAllEmployees(){if(window.confirm("Xác nhận muốn xóa tất cả nhân viên?"))try{const t=await k.deleteAll();this.reloadEmployees(),alert(`${t.message}`)}catch(t){console.error("Error deleting books:",t),alert("There was an error deleting all books.")}else alert("Delete operation was canceled.")}}},nt={class:"employee-management"},ot={class:"header"},at={class:"d-flex"};function rt(s,t,i,c,d,r){const e=E("router-link"),l=E("EmployeeTable");return n(),o("div",nt,[a("div",ot,[a("div",at,[t[3]||(t[3]=a("h2",null,"Quản lý nhân viên",-1)),a("button",{onClick:t[0]||(t[0]=(...g)=>r.reloadEmployees&&r.reloadEmployees(...g)),class:"reload-btn"},t[2]||(t[2]=[a("i",{class:"fa fa-sync-alt"},null,-1)]))]),_(e,{to:{name:"employees-create"},class:"btn btn-dark"},{default:V(()=>t[4]||(t[4]=[a("i",{class:"fa fa-plus"},null,-1),p(" Thêm mới ")])),_:1})]),_(l,{employees:d.employees,onReloadEmployees:r.reloadEmployees},null,8,["employees","onReloadEmployees"]),a("button",{onClick:t[1]||(t[1]=(...g)=>r.deleteAllEmployees&&r.deleteAllEmployees(...g)),class:"delete-all-btn"},t[5]||(t[5]=[a("i",{class:"fa fa-trash"},null,-1)]))])}const ct=v(st,[["render",rt],["__scopeId","data-v-8a28a956"]]);export{ct as default};
